{# C:\am\allifapp\allifapperp\allifmaalcommonapp\templates\allifmaalcommonapp\expenses\expenses.html #}
{% extends 'allifmaalcommonapp/base/uimainbase/allifmaaluibase.html'%}
{% load humanize %}

{% block title %}
{{title}}
{% endblock %}

{% block style %}
{# Add any specific styles for this template here #}
<style>
    /* Your existing table styles */
    #sortable-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    #sortable-table th,
    #sortable-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    #sortable-table th {
        background-color: #f2f2f2;
    }

    #sortable-table th:hover {
        background-color: #ddd;
    }
    /* Styles for the dropdown within the th */
    .sort-form-wrapper {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    .sort-form-wrapper label {
        margin-right: 10px;
        font-weight: 600;
        color: #4b5563;
    }
    .sort-form-wrapper select {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        background-color: #ffffff;
        margin-right: 10px;
    }
    .sort-form-wrapper button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        border-radius: 0.25rem;
        background-color: #3b82f6;
        color: #ffffff;
        border: none;
        cursor: pointer;
    }
    .sort-form-wrapper button:hover {
        background-color: #2563eb;
    }

    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .status-approved { background-color: #dcfce7; color: #16a34a; }
    .status-waiting { background-color: #fef9c3; color: #a16207; }
    .status-active { background-color: #e0f2fe; color: #0284c7; }
    .status-archived { background-color: #e5e7eb; color: #4b5563; }
    .dropdown-toggle {
        cursor: pointer;
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        border-radius: 0.375rem;
        overflow: hidden;
    }
    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }
    .dropdown-content a:hover {
        background-color: #f1f1f1;
    }
    .dropdown.show .dropdown-content {
        display: block;
    }
</style>
{%endblock%}

{% block body %}

<div class="allifmaal-main-container">

    <div class="allif-header-main-wrapper">
        {% include 'allifmaalcommonapp/includes/headers/header-upper-section.html' %}
        <a href="">Expenses</a> 
        {% include 'allifmaalcommonapp/includes/headers/header-lower-section.html' %}
    </div>

    <div class="allifmaincontainer">

        {# --- Scope Filter Buttons --- #}
        <div class="filter-options mt-3 mb-3">
            <h5 class="mb-2">View Records:</h5>
            <div class="btn-group" role="group" aria-label="Record Scope">
                {# These links will still use GET for scope, and preserve current sort_ui_label #}
                <a href="" 
                   class="btn btn-outline-primary {% if current_scope == 'active' %}active{% endif %}">
                    Active
                </a>
                <a href="" 
                   class="btn btn-outline-primary {% if current_scope == 'all' %}active{% endif %}">
                    All
                </a>
                <a href="" 
                   class="btn btn-outline-primary {% if current_scope == 'archived' %}active{% endif %}">
                    Archived
                </a>
            </div>
        </div>

        <h1>{{ title }}</h1>

        {# --- Sorting Form (POST-based) --- #}
        <div class="sort-form-wrapper">
            <form method="POST" action="">
                {% csrf_token %}
                <label for="sort_option">Sort By:</label>
                <select name="sort_option" id="sort_option">
                    {% for ui_label, field_name in sort_options %}
                        <option value="{{ ui_label }}" {% if current_sort_ui_label == ui_label %}selected{% endif %}>
                            {{ ui_label }}
                        </option>
                    {% endfor %}
                </select>
                <button type="submit">Apply Sort</button>
            </form>
        </div>

        <div class="allif-details-table-main-wrapper">
            <div class="row mt-12">
                <div class="table-details-content-description">{{title}}</div>
                <div class="col-md-12">
                    <div class="allif-scroll-table">
                        <div class="table-responsive allif-full-table">
                            <table class="table table-layout" id="sortable-table">
                                <thead>
                                    <tr class="allif-table-header-row">
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expense</th> 
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th> 
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th> 
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th> 
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created At</th> 
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Posting</th> 

                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Navigate</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> . . . </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for item in allifqueryset %} 
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ forloop.counter }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 hover:underline cursor-pointer">
                                            <a href="">{{item.description}}</a>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{item.supplier}}</td> 
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{item.quantity|floatformat:2|intcomma}}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{item.amount|floatformat:2|intcomma}}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ item.created_at|date:"Y-m-d H:i" }}</td> 
                                        
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="status-badge 
                                                {% if item.status == 'Approved' %}status-approved
                                                {% elif item.status == 'waiting' %}status-waiting
                                                {% elif item.status == 'Active' %}status-active
                                                {% else %}status-archived{% endif %}">
                                                {{item.status}}
                                            </span>
                                        </td>
                                        
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <div class="relative inline-block text-left">
                                                <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dropdown-toggle" id="options-menu-{{item.id}}" aria-haspopup="true" aria-expanded="true">
                                                    Options
                                                    <i class="fas fa-chevron-down ml-2 -mr-1 h-5 w-5"></i>
                                                </button>
                                                <div class="dropdown-content hidden" aria-labelledby="options-menu-{{item.id}}">
                                                    <a href="" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100">Edit Item</a>
                                                    <a href="#" onclick="confirmDelete(this)" class="text-red-700 block px-4 py-2 text-sm hover:bg-gray-100">Delete Item</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> . . . </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                    </tr>
                                    {% empty %}
                                        <tr><td colspan="9" class="px-6 py-4 text-center text-sm text-gray-500">No expenses available.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="allif-content-spacer h-16"></div>

    </div>{# /allifmaincontainer #}

</div>{# /allifmaal-main-container #}

{% endblock %}

{% block scripts %}
{# Your existing auto-save script and collapsible link script would go here #}

{% endblock %}
