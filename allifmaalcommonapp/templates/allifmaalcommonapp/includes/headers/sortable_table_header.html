




     {# C:\am\allifapp\allifapperp\allifmaalcommonapp\includes\sortable_table_header.html #}
{# Renders a sortable table header (<th>) with dynamic sorting links and icons. #}
{# Requires Font Awesome for icons (link in base template). #}

{# Context variables expected: #}
{# - column_display_name: The text to display in the header (e.g., "Product Name", "Date"). REQUIRED #}
{# - sort_field_name: The actual model field name for sorting (e.g., "name", "created_at"). REQUIRED #}
{# - current_scope: The current scope filter (e.g., 'active', 'all', 'archived'). OPTIONAL, default '' #}
{# - current_sort: The currently applied sort string (e.g., 'name', '-date'). REQUIRED #}
{# - base_url_name: The Django URL name of the current view (e.g., 'product_list_view'). REQUIRED #}
{# - user_var: The user slug for URL reversing. REQUIRED #}
{# - glblslug: The company slug for URL reversing. REQUIRED #}

{% comment %}
    Build the URL for sorting.
    It preserves the current 'scope' and toggles the 'sort' parameter.
    We pass user_var and glblslug explicitly to the {% url %} tag.
{% endcomment %}

{# Corrected URL tag: Pass arguments explicitly #}
{% url base_url_name user_var=user_var company_slug=glblslug as base_url %}

{% with next_sort_param="" %}
    {% if current_sort == sort_field_name %}
        {# If currently ascending, next click will be descending #}
        {% with next_sort_param='-'|add:sort_field_name %}{% endwith %}
    {% elif current_sort == '-'|add:sort_field_name %}
        {# If currently descending, next click will be ascending #}
        {% with next_sort_param=sort_field_name %}{% endwith %}
    {% else %}
        {# If not currently sorted by this field, default to ascending #}
        {% with next_sort_param=sort_field_name %}{% endwith %}
    {% endif %}

    <th class="sortable">
        <a href="{{ base_url }}?sort={{ next_sort_param }}{% if current_scope %}&scope={{ current_scope }}{% endif %}"
           class="text-decoration-none text-dark">
            {{ column_display_name }}
            {# Display sort icon based on current sort state #}
            {% if current_sort == sort_field_name %}
                <i class="fas fa-sort-up"></i> {# Ascending icon #}
            {% elif current_sort == '-'|add:sort_field_name %}
                <i class="fas fa-sort-down"></i> {# Descending icon #}
            {% else %}
                <i class="fas fa-sort"></i> {# Unsorted icon #}
            {% endif %}
        </a>
    </th>
{% endwith %}
