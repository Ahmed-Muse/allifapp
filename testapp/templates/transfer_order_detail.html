{% extends 'base.html' %}
{% block title %}Transfer Order #{{ transfer_order.order_number }}{% endblock %}

{% block content %}
<h2>Transfer Order #{{ transfer_order.order_number }} ({{ current_company.name }})</h2>

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<p><strong>Status:</strong> {{ transfer_order.status }}</p>
<p><strong>Source Location:</strong> {{ transfer_order.source_location.name }}</p>
<p><strong>Destination Location:</strong> {{ transfer_order.destination_location.name }}</p>
<p><strong>Order Date:</strong> {{ transfer_order.order_date }}</p>
<p><strong>Expected Delivery:</strong> {{ transfer_order.expected_delivery_date|default:"N/A" }}</p>
<p><strong>Description:</strong> {{ transfer_order.description|default:"N/A" }}</p>
<p><strong>Initiated By:</strong> {{ transfer_order.initiated_by.username }}</p>

<h3>Items</h3>
<table class="table">
    <thead>
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Transferred Unit Cost</th>
            <th>Total Value</th>
        </tr>
    </thead>
    <tbody>
        {% for item in transfer_order.items.all %}
        <tr>
            <td>{{ item.product.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.transferred_unit_cost }}</td>
            <td>{{ item.total_transferred_value }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="4">No items in this transfer order.</td></tr>
        {% endfor %}
    </tbody>
</table>

<h3>Actions</h3>
{% if transfer_order.status == 'Draft' or transfer_order.status == 'Pending Approval' %}
    <a href="{% url 'transfer_order_approve' pk=transfer_order.pk %}" class="btn btn-success">Approve Transfer Order</a>
{% elif transfer_order.status == 'Approved' %}
    <a href="{% url 'create_gin' to_pk=transfer_order.pk %}" class="btn btn-warning">Create Goods Issue Note (GIN)</a>
{% elif transfer_order.status == 'Issued' %}
    <a href="{% url 'create_grn' to_pk=transfer_order.pk %}" class="btn btn-success">Create Goods Receipt Note (GRN)</a>
{% endif %}

{% if transfer_order.goods_issue_note %}
    <p class="mt-3">Associated GIN: <a href="{% url 'gin_detail' pk=transfer_order.goods_issue_note.pk %}">{{ transfer_order.goods_issue_note.gin_number }}</a></p>
{% endif %}
{% if transfer_order.goods_receipt_note %}
    <p>Associated GRN: <a href="{% url 'grn_detail' pk=transfer_order.goods_receipt_note.pk %}">{{ transfer_order.goods_receipt_note.grn_number }}</a></p>
{% endif %}

<a href="{% url 'transfer_order_list' %}" class="btn btn-secondary mt-3">Back to List</a>
{% endblock %}